{"title":"Animated Plots","markdown":{"yaml":{"title":"Animated Plots","authors":["Joey Trampush"],"date":"2021-06-25","slug":"animated-plots","subtitle":"Trajectory of working memory using gganimate","summary":"","lastmod":"2021-06-25T13:36:25-07:00","featured":"no","projects":[],"categories":["R"],"tags":["R Markdown","plot","ggplot2","gganimate"],"output":{"blogdown::html_page":{"toc":false,"fig_width":7,"fig_asp":0.618,"fig_retina":2}},"rmd_hash":"ad12fe1c1b68566d"},"headingText":"Ridgeline plots using `ggridges`","containsRefs":false,"markdown":"\n\n**Insert Lead paragraph here.**\n\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE, message = FALSE)\n```\n\n```{r}\n# Load required R packages:\nlibrary(here)\nlibrary(tidyverse)\nlibrary(data.table)\nlibrary(purrr)\nlibrary(ggridges) # ridgeline plots\nlibrary(ggthemes) # wsj, tufte, 538, hc\nlibrary(gganimate) # animate and create gifs\nlibrary(scales)\nlibrary(tweenr)\nlibrary(htmlwidgets)\nlibrary(widgetframe)\nlibrary(crosstalk)\nlibrary(manipulateWidget)\n```\n\n```{r, eval=F, include=F}\n# NIH EXAMINER working memory data - fill sample\nwm <- data.table::fread(\"/Users/joey/brainworkup.io/static/data/wm.csv\")\n# tidy data\nwm <- wm %>%\n  dplyr::mutate(age_int = trunc(age)) %>%\n  relocate(age_int, .after = age)\n\nwm <- wm %>%\n  mutate(\n    age_5y = case_when(\n      age_int == 3 ~ 3,\n      age_int == 4 ~ 4,\n      age_int == 5 ~ 5,\n      age_int == 6 ~ 6,\n      age_int == 7 ~ 7,\n      age_int == 8 ~ 8,\n      age_int == 9 ~ 9,\n      age_int == 10 ~ 10,\n      age_int == 11 ~ 11,\n      age_int == 12 ~ 12,\n      age_int == 13 ~ 13,\n      age_int == 14 ~ 14,\n      age_int == 15 ~ 15,\n      age_int == 16 ~ 16,\n      age_int == 17 ~ 17,\n      age_int == 18 ~ 18,\n      age_int == 19 ~ 19,\n      age_int %in% 20:24 ~ 20,\n      age_int %in% 25:29 ~ 25,\n      age_int %in% 30:34 ~ 30,\n      age_int %in% 35:39 ~ 35,\n      age_int %in% 40:44 ~ 40,\n      age_int %in% 45:49 ~ 45,\n      age_int %in% 50:54 ~ 50,\n      age_int %in% 55:59 ~ 55,\n      age_int %in% 60:64 ~ 60,\n      age_int %in% 65:69 ~ 65,\n      age_int %in% 70:74 ~ 70,\n      age_int %in% 75:79 ~ 75,\n      age_int %in% 80:84 ~ 80,\n      age_int %in% 85:89 ~ 85,\n      age_int %in% 90:99 ~ 90\n    )\n  ) %>%\n  relocate(age_5y, .after = age_int)\n\nwm <- wm %>%\n  mutate(\n    age_5y.1 = case_when(\n      age_int %in% 3:9 ~ 5,\n      age_int %in% 10:14 ~ 10,\n      age_int %in% 15:19 ~ 15,\n      age_int %in% 20:24 ~ 20,\n      age_int %in% 25:29 ~ 25,\n      age_int %in% 30:34 ~ 30,\n      age_int %in% 35:39 ~ 35,\n      age_int %in% 40:44 ~ 40,\n      age_int %in% 45:49 ~ 45,\n      age_int %in% 50:54 ~ 50,\n      age_int %in% 55:59 ~ 55,\n      age_int %in% 60:64 ~ 60,\n      age_int %in% 65:69 ~ 65,\n      age_int %in% 70:74 ~ 70,\n      age_int %in% 75:79 ~ 75,\n      age_int %in% 80:84 ~ 80,\n      age_int %in% 85:89 ~ 85,\n      age_int %in% 90:99 ~ 90\n    )\n  ) %>%\n  relocate(age_5y.1, .after = age_5y)\n\nwm <- wm %>%\n  mutate(\n    age_10y = case_when(\n      age_int %in% 3:9 ~ 0,\n      age_int %in% 10:19 ~ 10,\n      age_int %in% 20:29 ~ 20,\n      age_int %in% 30:39 ~ 30,\n      age_int %in% 40:49 ~ 40,\n      age_int %in% 50:59 ~ 50,\n      age_int %in% 60:69 ~ 60,\n      age_int %in% 70:79 ~ 70,\n      age_int %in% 80:89 ~ 80,\n      age_int %in% 90:99 ~ 90\n    )\n  ) %>%\n  relocate(age_10y, .after = age_5y.1)\n\n# age as integer\nwm <- wm[, age := as.integer(age)]\nwm <- wm[, age_int := as.integer(age_int)]\nwm <- wm[, age_5y := as.integer(age_5y)]\nwm <- wm[, age_5y.1 := as.integer(age_5y.1)]\nwm <- wm[, age_10y := as.integer(age_10y)]\n\n# as tibble\nwm <- as_tibble(wm)\n\n# convert names\nnames_fresh <- names(wm) %>%\n  str_replace_all(\"[#%()]\", \"\") %>%\n  str_replace_all(\"[ /]\", \"_\") %>%\n  str_to_lower()\n\n# set names\nwm <- wm %>%\n  set_names(names_fresh)\n\n# write out indiv tests\nreadr::write_csv(wm, \"wm.csv\")\n```\n\n```{r wm}\n# NIH EXAMINER working memory data - fill sample\nwm <- data.table::fread(\"wm.csv\")\n\n# wm phenos\npheno <- data.frame(wm %>% select(\n  age_10y,\n  wm,\n  dots,\n  nback1,\n  nback2\n))\n\n# Define function using .data[[]] pronoun\n\nplot_for_loop <- function(df, x_var, y_var) {\n  # plot code\n  plots <- ggplot(df, na.rm = TRUE, aes(x = .data[[x_var]], y = as.factor(.data[[y_var]]), fill = stat(x))) +\n    geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01, gradient_lwd = 0.5) +\n    scale_x_continuous(expand = c(0, 0)) +\n    scale_y_discrete(expand = expansion(mult = c(0, 0))) +\n    scale_fill_viridis_c(name = \"zScore:\", option = \"A\", direction = -1) +\n    labs(\n      title = \"Figure 1. Change in mean working memory performance across the lifespan\",\n      subtitle = \"\",\n      x = \"Working memory factor\",\n      y = \"Age group\"\n    ) +\n    # theme_fivethirtyeight() +\n    # theme_hc() +\n    theme(axis.title = element_text(size = 12))\n}\n\n# Loop through every column\nplot_list <- colnames(pheno)[-1] %>%\n  map(~ plot_for_loop(pheno, .x, colnames(pheno)[1]))\n\n# save each file to the corresponding location on disk:\npaths <- stringr::str_c(names(pheno)[-1], \".pdf\")\npwalk(list(paths, plot_list), ggsave, path = getwd(), device = \"pdf\", scale = 1, width = 11.69, height = 8.27, units = \"in\")\n\n# Combine all plots\nlibrary(cowplot)\nplot_grid(plotlist = plot_list, ncol = 2)\nggsave(\"cow.pdf\", path = getwd(), device = \"pdf\", scale = 1, width = 11.69, height = 8.27, units = \"in\")\n```\n\n## WM animations using `gganimate`\n\n```{r data-wm}\n# NIH EXAMINER working memory data - fill sample\nwm <- data.table::fread(\"wm.csv\")\n\n# gganimate code\nanim <- ggplot2::ggplot(wm, na.rm = TRUE, aes(x = wm, y = as.factor(age_10y), fill = stat(x))) +\n  geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01, gradient_lwd = 0.5) +\n  scale_x_continuous(expand = c(0, 0)) +\n  scale_y_discrete(expand = expansion(mult = c(0, 0))) +\n  scale_fill_viridis_c(name = \"z-Score:\", option = \"A\", direction = -1) +\n  theme_wsj() +\n  theme(axis.title = element_text(size = 12)) +\n  # Here comes the gganimate specific bits\n  labs(\n    title = \"Age: {frame_time}\",\n    subtitle = \"Trajectory of WM\",\n    x = \"Working memory factor\",\n    y = \"Age group\"\n  ) +\n  gganimate::transition_time(age_10y) +\n  gganimate::ease_aes(\"linear\") +\n  gganimate::enter_fade() +\n  gganimate::exit_fade()\n```\n\n```{r}\ngganimate::animate(anim, fps = 20)\n```\n\n```{r, eval=F}\nknitr::include_graphics(\"/Users/joey/brainworkup.io/static/data/anim.gif\")\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":{"blogdown::html_page":{"toc":false,"fig_width":7,"fig_asp":0.618,"fig_retina":2}},"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../../styles.css"],"toc":true,"output-file":"index.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.215","theme":"cosmo","title":"Animated Plots","authors":["Joey Trampush"],"date":"2021-06-25","slug":"animated-plots","subtitle":"Trajectory of working memory using gganimate","summary":"","lastmod":"2021-06-25T13:36:25-07:00","featured":"no","projects":[],"categories":["R"],"tags":["R Markdown","plot","ggplot2","gganimate"],"rmd_hash":"ad12fe1c1b68566d"},"extensions":{"book":{"multiFile":true}}}}}